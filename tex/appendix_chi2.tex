\chapter{Calculation of the track derivatives used in Linearised $\chi^{2}$ Track Fitter}\label{app:chi2}
The derivation of the track derivatives that form the matrix elements of \emph{D} and \emph{M} in equations~\ref{eq:chi1}~--~\ref{eq:chi4} for the linearised $\chi^{2}$ track fit described in Chapter~\ref{tk-upgrade} was originally described in an internal CMS Detector Note~\cite{CMS_DN-14-043}.

In this appendix, it is shown how these track derivatives were obtained.
%
%By considering the $\phi$ and $z$ coordinates of a track's trajectory, as a function of r, 
%
%\begin{equation}
%\phi_{i} =  \phi_{0} - \arcsin ( \frac{r_{i} \rho^{-1}}{2} ) \;.
%z_{i} = z_{i} = z_{0} + 2 \rho t \arcsin (\frac{r_{i}}{2 \rho}) \;.
%\label{eq:projections}
%\end{equation}
%
%the residuals for both the barrel layer and endcap disk hits can be arrived at and approximated to first order.

\section{Barrel Layer Hits}
Considering that  

Wtuh 

\begin{equation}
f_{i}(\rho^{-1},\phi_{0}) = r_{i} \phi_{i} = r_{i} \phi_{0} - r_{i} \arcsin ( \frac{r_{i} \rho^{-1}}{2} ) \;
f_{i}(t,z_{0}) = z_{i} = z_{0} + 2 \rho t \arcsin (\frac{r_{i}}{2 \rho}) \;
\end{equation}

\begin{equation}
\frac{\partial s_{i}}{\partial \rho^{-1}} = - \frac{r_{i}^{2}}{2 \sqrt{1 - \frac{r_{i}^{2} \rho^{-2} }{4}}  \;.
\label{eq:barrel1}
\end{equation}

\begin{equation}
\frac{\partial s_{i}}{\partial \phi_{0}} = r_{i} \;.
\label{eq:barrel2}
\end{equation}

\begin{equation}
\frac{\partial s_{i}}{\partial t} = 2 \rho \arcsin (\frac{r_{i} \rho^{-1}}{2}) \approx r_{i} \;.
\label{eq:barrel3}
\end{equation}

\begin{equation}
\frac{\partial s_{i}}{\partial z_{0}} = 1 \;.
\label{eq:barrel4}
\end{equation}

As these first order approximation of these residuals depend solely on the position of barrel layers, making the task of tabulating the possible values straightforward.

\section{Endcap Disk Hits}
The hits in the endcap disks are not 

\begin{equation}
\frac{\partial r}{\partial \rho^{-1}} = - 2 \rho^{2} sin \Big( \frac{\rho^{-1}}{2t} (z_{disk} - z_{0}) \Big) + \frac{z_{disk} - z_{0}}{\rho^{-1} t} cos \Big( \frac{\rho^{-1}}{2t} (z_{disk} - z_{0}) \Big) \;.
\label{eq:endcap1}
\end{equation}

\begin{equation}
\frac{\partial r}{\partial \phi_{0}} = 0 \;.
\label{eq:endcap2}
\end{equation}

\begin{equation}
\frac{\partial r}{\partial t} = - \frac{z_{disk} - z_{0}}{t^{2}} cos \Big( \frac{\rho^{-1}}{2t} (z_{disk} - z_{0}) \Big) \;.
\label{eq:endcap3}
\end{equation}

\begin{equation}
\frac{\partial r}}{\partial z_{0}} = - \frac{1}{t} cos \Big( \frac{\rho^{-1}}{2t} (z_{disk} - z_{0}) \Big) \;.
\label{eq:endcap4}
\end{equation}

\begin{equation}
\frac{\partial \phi}{\partial \rho^{-1}} = - \frac{z_{disk} - z_{0}}{2t} \;.
\label{eq:endcap5}
\end{equation}

\begin{equation}
\frac{\partial \phi}{\partial \phi_{0}} = 1 \;.
\label{eq:endcap6}
\end{equation}

\begin{equation}
\frac{\partial \phi}{\partial t} = \frac{\rho^{-1}}{2t^{2}} (z_{disk} - z_{0} \;.
\label{eq:endcap7}
\end{equation}

\begin{equation}
\frac{\partial \phi}{\partial z_{0}} = \frac{\rho^{-1}}{2t} \;.
\label{eq:endcap8}
\end{equation}

\subsection{Outer Disks}
As the outer disks do not provide a direct measurement of $\phi$, $\phi_{hit}$, as the 2S modules' strips do not point directly towards the interaction point, a corrective factor is used to determine this using the 

\begin{equation}
\phi_{hit} = \phi_{centre} + \alpha ( r - r_{centre} )
\label{OuterHits1}
\end{equation}

\begin{equation}
r(h)  = r(h + \delta h) = r(h) + \delta h \frac{\partial r}{\partial h} + \mathcal{0} (\delta h^{2})
\phi(h)  = \phi(h + \delta h) = \phi(h) + \delta h \frac{\partial \phi}{\partial h} + \mathcal{0} (\delta h^{2})
\label{OuterHits2}
\end{equation}

\begin{equation}
\delta_{\phi} = \phi (h) - \phi_{hit} = \phi (h) - \phi_{centre} - \alpha ( r - r_{centre} )
\label{OuterHits3}
\end{equation}

\begin{equation}
\frac{\partial \delta_{phi}}{\partial h} = \frac{\partial \phi}{\partial h} - \alpha \frac{\partial r}{\partial h}
\label{OuterHits4}
\end{equation}
